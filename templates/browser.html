{% extends "layout.html" %}

{% block title %}
    Browser
{% endblock %}

{% block left_nav %}
    <h5>Category</h5>
    <h5>
        <!-- Populate side nav options for filtering display of products -->
        <a class="nav-link active" onclick="genDisplay('All')">All</a>
        {% for item in CATEGORY %}
            <a class="nav-link" onclick="genDisplay('{{item}}')">{{item}}</a>
        {% endfor %}
    </h5>
{% endblock %}

{% block right_nav %}
{% endblock %}

{% block main %}
    <div class="content">
        <h1>Products Browser</h1>
        
        <!-- Display context is generated by javascript below -->
        <div id="browse_product"></div>
    </div>

    <script>
        function genDisplay(filter) {
            let products_db = {{products|tojson|safe}};
            var browser_html = `<div class="d-flex flex-row flex-wrap justify-content-around">`;

            for (let row of products_db) {
                if (filter == "All" || filter == row["category"]) {
                    browser_html += `<div class="p-2 bd-highlight">`;
                    browser_html += `<div class="card" style="width: 18rem; height: 21rem">`;
                    browser_html += `<img src="../static/img/${row['image']}" class="card-img-top" alt="..." style="height: 12rem">`;
                    browser_html += `<div class="card-body">`;
                    browser_html += `<h5 class="card-title">${row["product_name"]}</h5>`;
                    browser_html += `<h6><div class="row card-text"style="padding: 5px;"><div class="col-sm">$ ${row["price"].toFixed(1)}</div><div class="col-sm">Stock: ${row["stock"]}</div></div></h6>`;
                    browser_html += `<form name="add_to_cart" action="/add_to_cart" method="post">`;
                    browser_html += `<input type="hidden" name="product_id" value=${row["product_id"]}>`;
                    browser_html += `<button type="submit" class="btn btn-primary">Add to Cart</button>`;
                    browser_html += `</form>`;
                    browser_html += `</div>`;
                    browser_html += `</div>`;
                    browser_html += `</div>`;
                }
            }
            browser_html += `</div>`;

            document.getElementById("browse_product").innerHTML = browser_html;
            return;
        }

        genDisplay("All");

    </script>
{% endblock %}
